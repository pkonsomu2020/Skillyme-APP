# GitHub Actions workflow to keep Render backend warm
name: Keep Backend Warm

on:
  schedule:
    # Run every 10 minutes to keep backend warm
    - cron: '*/10 * * * *'
  workflow_dispatch: # Allow manual trigger

jobs:
  ping-backend:
    runs-on: ubuntu-latest
    
    steps:
    - name: Ping Skillyme Backend
      run: |
        echo "ğŸ”¥ Pinging Skillyme backend to keep it warm..."
        
        # Simple ping to keep backend alive
        response_code=$(curl -s -o /dev/null -w "%{http_code}" \
          -X GET \
          -H "User-Agent: GitHub-Actions-Warmer/1.0" \
          --max-time 30 \
          https://skillyme-backend-s3sy.onrender.com/api/sessions || echo "000")
        
        echo "ğŸ“Š Response: HTTP $response_code"
        
        # Check if successful (200, 401, 404 are all fine - means server is responding)
        if [ "$response_code" = "200" ] || [ "$response_code" = "401" ] || [ "$response_code" = "404" ]; then
          echo "âœ… Backend is warm and responding"
        elif [ "$response_code" = "000" ]; then
          echo "âš ï¸  Backend timeout or connection error - but this is normal for cold starts"
        else
          echo "âš ï¸  Backend responded with HTTP $response_code - but server is alive"
        fi
        
        echo "ğŸ• Next ping in 10 minutes"

    - name: Log Warming Activity
      run: |
        echo "Backend warming completed at $(date)"
        echo "This keeps the Render free tier backend active and prevents cold starts"